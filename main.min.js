'use strict';class q{constructor(){this.g=this.h=Date.now()}start(a){requestAnimationFrame(this.update=this.update.bind(this,a));window.onkeydown=this.i.bind(a,!0);window.onkeyup=this.i.bind(a,!1)}i(a,b){switch(b.key){case "ArrowRight":b=this.v;a?b.direction=t:b.direction!==u&&(b.direction=v);break;case "ArrowLeft":b=this.v,a?b.direction=u:b.direction!==t&&(b.direction=v)}}update(a){var b=-this.g+(this.g=Date.now());const k=this.g-this.h;a.v.update(b,k);a.B.update(b,k);a.update(b);b=w;b.h.clearRect(0,
0,b.w,b.g);var l=Number(a.j%BigInt(a.o))/a.o*b.g,m=a.j/BigInt(a.o)%2n;b.h.drawImage(b.m[m?"wall":"wall2"],0,l,b.w,b.g);b.h.drawImage(b.m[m?"wall2":"wall"],0,l+(0>a.j?b.g:-b.g),b.w,b.g);for(var n of a.B.iterator()){l=n.K(a)-x/2;m=(1-Number(n.y-a.j)/a.o)*a.I+5;const p=n.width(),d=n.height(),c=n.model();if(0>m+d)break;b.h.drawImage(b.m[c],l,m,p,d)}n=a.v;b.h.drawImage(b.m.hero1,n.screenX-y/2,n.screenY-100,y,100);a.D&&2E3<k-a.J?(z(A("#end-game"),A("#start-btn")),A("#pause-btn").style.display=""):requestAnimationFrame(this.update)}}
;class B{constructor(a,b){this.m=a;this.L=b}get x(){return this.m}get y(){return this.L}width(){return x}height(){return 20}model(){return"brick"}toString(){return`{x: ${this.x}, y: ${this.y}}`}K(a){return this.x/a.l*a.G}update(){}F(){return!0}}var x=100;class C extends B{model(){return"jump_brick"}height(){return 30}};class D{constructor(a){this.g=a;this.u=0n;this.h=this.g.l/2;this.i=0;this.m=this.A=0n;this.direction=v;this.H=!1}get screenY(){return this.g.I*(1-Number(this.u-this.g.j)/this.g.o)}get screenX(){return this.h/this.g.l*this.g.G}update(a,b){this.F(b);if(this.direction!==v){for(this.h=this.direction===u?this.h-a*this.g.l/1E3:this.h+a*this.g.l/1E3;0>this.h;)this.h+=this.g.l;for(;this.h>this.g.l;)this.h-=this.g.l}if(500<b-this.i)for(let k of this.g.B.iterator())if(k.y>=this.u){Math.abs(this.h-k.x)<=this.g.l/
this.g.G*(x+y)/2&&k.y>=this.u&&k.y<=this.m&&(this.H=k instanceof C,k.F(this.g.B),this.A=k.y,this.i=b,this.g.s=this.H?k.y+BigInt(3*this.g.o/4):k.y-BigInt(this.g.o/4),E(this.g.B));break}this.g.N=Number(this.u/100000n);500<b-this.i&&(a=this.g,!a.D&&(a.D=F(a.B,0).y>a.v.u)&&(a.J=b))}F(a){this.m=this.u;a-=this.i;a=BigInt(a);this.u=this.A+a*((this.H?10000n:5000n)-5n*a)}}var y=60,v=0,t=1,u=2;var A=document.querySelector.bind(document);class G{constructor(a,b=null){this.C=b;this.next=null;this.value=a}remove(a){this.C&&(this.C.next=this.next);this.next&&(this.next.C=this.C);a.first===this?a.first=this.next:a.last===this&&(a.last=this.C);a.length--;return this}}function H(a,...b){for(let k of b)b=new G(k,a.last),0===a.length++?a.first=b:a.last&&(a.last.next=b),a.last=b}function*I(a){let b=a.last;for(;b;){const k=yield b.value;if("number"==typeof k&&(k&J&&b.remove(a),k&K))break;b=b.C}}
function L(a,b,k){for(let l=b<a.length/2,m=l?a.iterator():I(a),n,p=l?0:a.length-1,d;!(n=m.next(d)).done;p+=l?1:-1)d=k(n,p)}function M(a,b){var k=0>b?b+a.length:b;if(k>=a.length||0>k)throw new RangeError(`Out of bounds: array with length ${a.length} called with index ${b}`);return k}function F(a,b){if(0!==a.length){let k;0===(b=M(a,b))?k=a.first.value:b===a.length-1?k=a.last.value:L(a,b,(l,m)=>{if(m===b)return k=l.value,K});return k}}
class N{constructor(...a){this.length=0;this.first=this.last=null;H(this,...a)}*iterator(){let a=this.first;for(;a;){let b=yield a.value,k;if("number"==typeof b||Array.isArray(b)&&(k=b[1],"number"==typeof(b=b[0])))if(b&J&&a.remove(this),b&O&&(a.value=k),b&K)break;a=a.next}}remove(a){for(var b=this.iterator(),k,l,m=0;!(k=b.next(l)).done;m++)k.value===a&&(l=J|K);return m}toString(){return Array.from(this.iterator()).toString()}}var J=1,K=2,O=4;const P=(1n<<48n)-1n,Q=Number(1n<<32n);var R=BigInt(Math.abs(~~(1E13*Math.random())));
function S(a){function b(d,c,e,f,g,h){d=p(p(c,d),p(f,h));return p(d<<g|d>>>32-g,e)}function k(d,c,e,f,g,h,r){return b(c&e|~c&f,d,c,g,h,r)}function l(d,c,e,f,g,h,r){return b(c&f|e&~f,d,c,g,h,r)}function m(d,c,e,f,g,h,r){return b(c^e^f,d,c,g,h,r)}function n(d,c,e,f,g,h,r){return b(e^(c|~f),d,c,g,h,r)}function p(d,c){var e=(65535&d)+(65535&c);return(d>>16)+(c>>16)+(e>>16)<<16|65535&e}return function(d){for(var c,e="",f=0;f<d.length;f++)c=d.charCodeAt(f),e+="0123456789ABCDEF".charAt(c>>>4&15)+"0123456789ABCDEF".charAt(15&
c);return e}(function(d){for(var c="",e=0;e<32*d.length;e+=8)c+=String.fromCharCode(d[e>>5]>>>e%32&255);return c}(function(d,c){d[c>>5]|=128<<c%32;d[14+(c+64>>>9<<4)]=c;c=1732584193;for(var e=-271733879,f=-1732584194,g=271733878,h=0;h<d.length;h+=16){var r=c,aa=e,ba=f,ca=g;e=n(e=n(e=n(e=n(e=m(e=m(e=m(e=m(e=l(e=l(e=l(e=l(e=k(e=k(e=k(e=k(e,f=k(f,g=k(g,c=k(c,e,f,g,d[h],7,-680876936),e,f,d[h+1],12,-389564586),c,e,d[h+2],17,606105819),g,c,d[h+3],22,-1044525330),f=k(f,g=k(g,c=k(c,e,f,g,d[h+4],7,-176418897),
e,f,d[h+5],12,1200080426),c,e,d[h+6],17,-1473231341),g,c,d[h+7],22,-45705983),f=k(f,g=k(g,c=k(c,e,f,g,d[h+8],7,1770035416),e,f,d[h+9],12,-1958414417),c,e,d[h+10],17,-42063),g,c,d[h+11],22,-1990404162),f=k(f,g=k(g,c=k(c,e,f,g,d[h+12],7,1804603682),e,f,d[h+13],12,-40341101),c,e,d[h+14],17,-1502002290),g,c,d[h+15],22,1236535329),f=l(f,g=l(g,c=l(c,e,f,g,d[h+1],5,-165796510),e,f,d[h+6],9,-1069501632),c,e,d[h+11],14,643717713),g,c,d[h],20,-373897302),f=l(f,g=l(g,c=l(c,e,f,g,d[h+5],5,-701558691),e,f,d[h+
10],9,38016083),c,e,d[h+15],14,-660478335),g,c,d[h+4],20,-405537848),f=l(f,g=l(g,c=l(c,e,f,g,d[h+9],5,568446438),e,f,d[h+14],9,-1019803690),c,e,d[h+3],14,-187363961),g,c,d[h+8],20,1163531501),f=l(f,g=l(g,c=l(c,e,f,g,d[h+13],5,-1444681467),e,f,d[h+2],9,-51403784),c,e,d[h+7],14,1735328473),g,c,d[h+12],20,-1926607734),f=m(f,g=m(g,c=m(c,e,f,g,d[h+5],4,-378558),e,f,d[h+8],11,-2022574463),c,e,d[h+11],16,1839030562),g,c,d[h+14],23,-35309556),f=m(f,g=m(g,c=m(c,e,f,g,d[h+1],4,-1530992060),e,f,d[h+4],11,1272893353),
c,e,d[h+7],16,-155497632),g,c,d[h+10],23,-1094730640),f=m(f,g=m(g,c=m(c,e,f,g,d[h+13],4,681279174),e,f,d[h],11,-358537222),c,e,d[h+3],16,-722521979),g,c,d[h+6],23,76029189),f=m(f,g=m(g,c=m(c,e,f,g,d[h+9],4,-640364487),e,f,d[h+12],11,-421815835),c,e,d[h+15],16,530742520),g,c,d[h+2],23,-995338651),f=n(f,g=n(g,c=n(c,e,f,g,d[h],6,-198630844),e,f,d[h+7],10,1126891415),c,e,d[h+14],15,-1416354905),g,c,d[h+5],21,-57434055),f=n(f,g=n(g,c=n(c,e,f,g,d[h+12],6,1700485571),e,f,d[h+3],10,-1894986606),c,e,d[h+10],
15,-1051523),g,c,d[h+1],21,-2054922799),f=n(f,g=n(g,c=n(c,e,f,g,d[h+8],6,1873313359),e,f,d[h+15],10,-30611744),c,e,d[h+6],15,-1560198380),g,c,d[h+13],21,1309151649),f=n(f,g=n(g,c=n(c,e,f,g,d[h+4],6,-145523070),e,f,d[h+11],10,-1120210379),c,e,d[h+2],15,718787259),g,c,d[h+9],21,-343485551);c=p(c,r);e=p(e,aa);f=p(f,ba);g=p(g,ca)}return[c,e,f,g]}(function(d){for(var c=Array(d.length>>2),e=0;e<c.length;e++)c[e]=0;for(e=0;e<8*d.length;e+=8)c[e>>5]|=(255&d.charCodeAt(e/8))<<e%32;return c}(a),8*a.length))).toLowerCase()}
function T(){let a=25214903917n*R+11n&P;R=a;return Number(a>>16n)/Q}function U(a,b){void 0===b&&(b=a,a=0);return~~(T()*(b-a))+a}function z(...a){for(let b of a)b.style.display="block",b.animate([{opacity:0},{opacity:1}],{duration:400,iterations:1});return new Promise(b=>setTimeout(b,400))};class V extends B{constructor(a,b,k,l,m=W){super(a,b);this.h=0;this.A=l;this.i=null;this.M=m;this.g=k}update(a,b){null===this.i?this.i=b:this.h=(b-this.i)%this.A/this.A}get x(){var a=this.m;switch(this.M){case W:a/=2*this.g;this.h<a?a=this.g*(a-this.h)*2:(a=this.g*(this.h-a)*2,a>this.g&&(a=2*this.g-a));break;case X:a=(this.g-a)/(2*this.g);this.h<a?a=this.g*(1-2*(a-this.h)):(a=this.g*(1-2*(this.h-a)),0>a&&(a=-a));break;case da:a=this.g*(1-this.h)+a;var b=this.g;a-=b*~~(a/b);break;case ea:a=this.g*
this.h+a,b=this.g,a-=b*~~(a/b)}return a}K(a){return this.x/this.g*a.G}}var W=0,X=1,ea=2,da=3;class fa extends B{F(a){a.remove(this);return super.F(a)}model(){return"no_brick"}};function E(a){for(var b=F(a,-1).y;b<(a.g.j>a.g.s?a.g.j:a.g.s)+BigInt(2*a.g.o);){var k=BigInt;var l=.0625;var m=.25;void 0===m&&(m=l,l=0);l=T()*(m-l)+l;b+=k(~~(l*a.g.o));k=U(0,a.g.l);l=T();let n;l<1/6?n=new V(k,b,a.g.l,U(1E3,4E3),~~(24*l)):l<=1/3?n=new fa(k,b):.4>=l?n=new C(k,b):n=new B(k,b);H(a,n)}for(let n=a.iterator(),p,d;!(p=n.next(d)).done;)d=p.value.y<=a.g.j?J:K}
class ha extends N{constructor(a){super(new B(a.l/2,BigInt(a.o/4)),new V(a.l/3,BigInt(a.o/3),a.l,2500,X));this.g=a;E(this)}update(a,b){for(let k of this.iterator())k.update(a,b)}};class ia{constructor(){var a=A("#drawer");this.D=!1;this.J=null;this.o=375E4;this.l=8E3;this.s=this.j=0n;this.h=new q;this.v=new D(this);this.B=new ha(this);w.update(a,400,800);this.g=0n;this.i=A("#score b")}set N(a){a>this.g&&(this.g=a,this.i.innerText=a)}get G(){return w.w}get I(){return w.g}update(a){this.D&&(this.s=this.v.u-BigInt(375E4));this.j!==this.s&&(this.s>this.j?(this.j+=BigInt(375E4*a/(this.v.H?500:2E3)),this.j>this.s&&(this.j=this.s)):(this.j-=BigInt(375E4*a/(this.D?300:1E3)),this.j<
this.s&&(this.j=this.s)))}};function ja(){var a=w;return Promise.all(a.A.map(b=>new Promise((k,l)=>{let m=new Image;m.src=`./img/${b}.png`;m.addEventListener("load",k);m.addEventListener("error",l);a.m[b]=m})))}class ka{constructor(){this.A="hero1 brick no_brick jump_brick wall wall2".split(" ");this.m={};this.i=this.h=void 0}update(a,b,k){this.i=a;this.i.width=b;this.i.height=k;this.h=a.getContext("2d")}get w(){return this.i.width}get g(){return this.i.height}};let Y,Z;var w=new ka;function la(){R=BigInt("0x"+S(Z.value));var a=Y=new ia;a.h.start(a);if(a=(a=window.matchMedia||window.msMatchMedia)&&a("(pointer:coarse)").matches){a=A(".move-buttons");z(a);for(let b=0,k;2>b;b++){let l=new Event("e");l.key=b?"ArrowRight":"ArrowLeft";(k=a.children[b]).ontouchstart=window.onkeydown.bind(window,l);k.ontouchend=window.onkeyup.bind(window,l)}}window.game=Y}
document.addEventListener("DOMContentLoaded",()=>{Z=A("#sid");ja().then(()=>{A("#start-btn").addEventListener("click",function(){document.querySelectorAll("#start-btn,#end-game").forEach(a=>a.style.display="none");z(A("#pause-btn")).then(()=>A("#start-btn").innerHTML="Restart");la()})});Z.value=S(R+"")});
